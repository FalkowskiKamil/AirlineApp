<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <meta charset="UTF-8">
    <title>Airline</title>
</head>
<body>
    <!-- Navigation bar -->
    <nav class="navbar navbar-light bg-light border">
        <div class="container-fluid">
            <div class="navbar-header">
                    <a class="navbar-brand" href="/airline/">Airlines</a>
                {% if user.groups.all.0.name == 'Staff' or request.user.is_superuser  %}
                    <a class="navbar-brand" href="/airline/staff">Staff</a>
                {% endif %}

            </div>
            <ul class="nav navbar-nav navbar-right">
                {% if user.is_authenticated%}
                <li>
                    <a class="btn btn-link" href="#">{{ user.first_name }}({{ user.username }})</a>
                    <a class="btn btn-link" href="{% url 'user:logout' %}">Logout</a>
                    {% if user.groups.all.0.name == 'Staff' or request.user.is_superuser  %}
                    <a class="btn btn-link" href="/airline/add_data">Add data</a>
                    {% endif %}
                </li>
                {% else %}
                <li>
                    <form class="form-inline" action="{% url 'user:login' %}" method="post">
                        {% csrf_token %}
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Username" name="username" >
                            <input type="password" class="form-control" placeholder="Password" name="psw" >
                            <button class="btn btn-primary" type="submit">Login</button>
                            <a class="btn btn-link" href="{% url 'user:registration' %}">Sign Up</a>
                        </div>
                    </form>
                </li>
                {% endif %}
            </ul>
        </div>
    </nav>
    <!-- Page content -->
{% block content %}
{% endblock %}
<script>
    var startSelect = document.getElementById('start');
    var destinationSelect = document.getElementById('destination');
    var tableRows = document.querySelectorAll('#flight-table-body tr');
    
    function filterRows() {
        var selectedStart = startSelect.value.toLowerCase();
        var selectedDestination = destinationSelect.value.toLowerCase();
        for (var i = 0; i < tableRows.length; i++) {
            var row = tableRows[i];
            var start = row.getAttribute('data-start').toLowerCase();
            var destination = row.getAttribute('data-destination').toLowerCase();
            if ((selectedStart === '' || start.includes(selectedStart)) &&
                (selectedDestination === '' || destination.includes(selectedDestination))) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        }
        stripeRows();
    }
    
    function stripeRows() {
        var visibleRows = document.querySelectorAll('#flight-table-body tr:not([style*="display: none"])');
        for (var i = 0; i < visibleRows.length; i++) {
            if (i % 2 === 0) {
                visibleRows[i].classList.add('bg-light');
            } else {
                visibleRows[i].classList.remove('bg-light');
            }
        }
    }
    
    startSelect.addEventListener('change', filterRows);
    destinationSelect.addEventListener('change', filterRows);
    document.addEventListener('DOMContentLoaded', function() {
        filterRows();
    });

    const searchInput = document.getElementById('search-input');
    const countryList = document.getElementById('country-list');
    const countries = countryList.querySelectorAll('li');

    searchInput.addEventListener('input', () => {
        const searchTerm = searchInput.value.toLowerCase();

        for (let i = 0; i < countries.length; i++) {
            const country = countries[i];
            const countryName = country.innerText.toLowerCase();

            if (countryName.includes(searchTerm)) {
                country.style.display = 'block';
            } else {
                country.style.display = 'none';
            }
        }
    });

    // Dodajemy obsługę zmiany wielkości liter w inpucie
    searchInput.addEventListener('change', () => {
        searchInput.value= searchInput.value.toLowerCase();
    });
</script>  
<script>
    function filterTable(startCountry, destinationCountry) {
      var table = document.getElementById("route_table");
      var tbody = table.getElementsByTagName("tbody")[0];
      var rows = tbody.getElementsByTagName("tr");
    
      for (var i = 0; i < rows.length; i++) {
        var row = rows[i];
        var start = row.getAttribute("data-start");
        var destination = row.getAttribute("data-destination");
    
        if ((startCountry == "" || start == startCountry) &&
            (destinationCountry == "" || destination == destinationCountry)) {
          row.style.display = "";
        } else {
          row.style.display = "none";
        }
    
        if (i % 2 == 0) {
          row.classList.add("table-striped");
        } else {
          row.classList.remove("table-striped");
        }
      }
    }
    
    var startInput = document.getElementById("start");
    var destinationInput = document.getElementById("destination");
    
    startInput.addEventListener("input", updateTable);
    destinationInput.addEventListener("input", updateTable);
    
    function updateTable() {
      filterTable(startInput.value, destinationInput.value);
    }
    </script>
    
    
</html>